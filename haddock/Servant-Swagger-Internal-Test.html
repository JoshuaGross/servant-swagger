<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Servant.Swagger.Internal.Test</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Servant-Swagger-Internal-Test.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Servant-Swagger-Internal-Test.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">servant-swagger-0.1.2: Generate Swagger specification for your servant API.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Servant.Swagger.Internal.Test</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">QuickCheck-related stuff</a></li></ul></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:validateEveryToJSON">validateEveryToJSON</a> :: <span class="keyword">forall</span> proxy api. <a href="Servant-Swagger-Internal-TypeLevel-TMap.html#t:TMap">TMap</a> (<a href="Servant-Swagger-Internal-TypeLevel-Every.html#t:Every">Every</a> `[<a href="../base-4.8.2.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a>, <a href="../base-4.8.2.0/Text-Show.html#t:Show">Show</a>, Arbitrary, ToJSON, <a href="../swagger2-1.2.1/Data-Swagger-Internal-Schema.html#t:ToSchema">ToSchema</a>]`) (<a href="Servant-Swagger-Internal-TypeLevel-API.html#t:BodyTypes">BodyTypes</a> JSON api) =&gt; proxy api -&gt; Spec</li><li class="src short"><a href="#v:props">props</a> :: <span class="keyword">forall</span> p p'' cs xs. <a href="Servant-Swagger-Internal-TypeLevel-TMap.html#t:TMap">TMap</a> (<a href="Servant-Swagger-Internal-TypeLevel-Every.html#t:Every">Every</a> (<a href="../base-4.8.2.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> : (<a href="../base-4.8.2.0/Text-Show.html#t:Show">Show</a> : (Arbitrary : cs)))) xs =&gt; p cs -&gt; (<span class="keyword">forall</span> x. <a href="Servant-Swagger-Internal-TypeLevel-Every.html#t:EveryTF">EveryTF</a> cs x =&gt; x -&gt; <a href="../base-4.8.2.0/Data-Bool.html#t:Bool">Bool</a>) -&gt; p'' xs -&gt; Spec</li></ul></div><div id="interface"><h1>Documentation</h1><div class="doc"><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>import GHC.Generics
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>import Test.QuickCheck
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:set -XDeriveGeneric
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:set -XGeneralizedNewtypeDeriving
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:set -XDataKinds
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:set -XTypeOperators
</code></strong></pre></div><div class="top"><p class="src"><a name="v:validateEveryToJSON" class="def">validateEveryToJSON</a> :: <span class="keyword">forall</span> proxy api. <a href="Servant-Swagger-Internal-TypeLevel-TMap.html#t:TMap">TMap</a> (<a href="Servant-Swagger-Internal-TypeLevel-Every.html#t:Every">Every</a> `[<a href="../base-4.8.2.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a>, <a href="../base-4.8.2.0/Text-Show.html#t:Show">Show</a>, Arbitrary, ToJSON, <a href="../swagger2-1.2.1/Data-Swagger-Internal-Schema.html#t:ToSchema">ToSchema</a>]`) (<a href="Servant-Swagger-Internal-TypeLevel-API.html#t:BodyTypes">BodyTypes</a> JSON api) =&gt; proxy api -&gt; Spec <a href="src/Servant-Swagger-Internal-Test.html#validateEveryToJSON" class="link">Source</a></p><div class="doc"><p>Verify that every type used with <code><code>JSON</code></code> content type in a servant API
 has compatible <code><code>ToJSON</code></code> and <code><code><a href="../swagger2-1.2.1/Data-Swagger-Internal-Schema.html#t:ToSchema">ToSchema</a></code></code> instances using <code><code><a href="../swagger2-1.2.1/Data-Swagger-Internal-Schema-Validation.html#v:validateToJSON">validateToJSON</a></code></code>.</p><p><code><code><a href="Servant-Swagger-Internal-Test.html#v:validateEveryToJSON">validateEveryToJSON</a></code></code> will produce one <code><code>prop</code></code> specification for every type in the API.
 Each type only gets one test, even if it occurs multiple times in the API.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>data User = User { name :: String, age :: Maybe Int } deriving (Show, Generic, Typeable)
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>newtype UserId = UserId String deriving (Show, Generic, Typeable, ToJSON, Arbitrary)
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>instance ToJSON User
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>instance ToSchema User
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>instance ToSchema UserId
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>instance Arbitrary User where arbitrary = User &lt;$&gt; arbitrary &lt;*&gt; arbitrary
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>type UserAPI = (Capture &quot;user_id&quot; UserId :&gt; Get '[JSON] User) :&lt;|&gt; (ReqBody '[JSON] User :&gt; Post '[JSON] UserId)
</code></strong></pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>hspec $ context &quot;ToJSON matches ToSchema&quot; $ validateEveryToJSON (Proxy :: Proxy UserAPI)
</code></strong>
ToJSON matches ToSchema
  User
  UserId

Finished in ... seconds
2 examples, 0 failures
</pre><p>For the test to compile all body types should have the following instances:</p><ul><li><code><code>ToJSON</code></code> and <code><code><a href="../swagger2-1.2.1/Data-Swagger-Internal-Schema.html#t:ToSchema">ToSchema</a></code></code> are used to perform the validation;</li><li><code><code><a href="../base-4.8.2.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a></code></code> is used to name the test for each type;</li><li><code><code><a href="../base-4.8.2.0/Text-Show.html#t:Show">Show</a></code></code> is used to display value for which <code><code>ToJSON</code></code> does not satisfy <code><code><a href="../swagger2-1.2.1/Data-Swagger-Internal-Schema.html#t:ToSchema">ToSchema</a></code></code>.</li><li><code><code>Arbitrary</code></code> is used to arbitrarily generate values.</li></ul><p>If any of the instances is missing, you'll get a descriptive type error:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>data Contact = Contact { fullname :: String, phone :: Integer } deriving (Show, Generic)
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>instance ToJSON Contact
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>instance ToSchema Contact
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>type ContactAPI = Get '[JSON] Contact
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>hspec $ validateEveryToJSON (Proxy :: Proxy ContactAPI)
</code></strong>...
    No instance for (Arbitrary Contact)
      arising from a use of &#8216;validateEveryToJSON&#8217;
...
</pre></div></div><h1 id="g:1">QuickCheck-related stuff</h1><div class="top"><p class="src"><a name="v:props" class="def">props</a> :: <span class="keyword">forall</span> p p'' cs xs. <a href="Servant-Swagger-Internal-TypeLevel-TMap.html#t:TMap">TMap</a> (<a href="Servant-Swagger-Internal-TypeLevel-Every.html#t:Every">Every</a> (<a href="../base-4.8.2.0/Data-Typeable-Internal.html#t:Typeable">Typeable</a> : (<a href="../base-4.8.2.0/Text-Show.html#t:Show">Show</a> : (Arbitrary : cs)))) xs =&gt; p cs -&gt; (<span class="keyword">forall</span> x. <a href="Servant-Swagger-Internal-TypeLevel-Every.html#t:EveryTF">EveryTF</a> cs x =&gt; x -&gt; <a href="../base-4.8.2.0/Data-Bool.html#t:Bool">Bool</a>) -&gt; p'' xs -&gt; Spec <a href="src/Servant-Swagger-Internal-Test.html#props" class="link">Source</a></p><div class="doc"><p>Construct property tests for each type in a list.
 The name for each property is the name of the corresponding type.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:{
</code></strong> hspec $
   context &quot;read . show == id&quot; $
     props
       (Proxy :: Proxy [Eq, Show, Read])
       (\x -&gt; read (show x) == x)
       (Proxy :: Proxy [Bool, Int, String])
:}

read . show == id
  Bool
  Int
  [Char]

Finished in ... seconds
3 examples, 0 failures
</pre></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.16.1</p></div></body></html>